from controlador.validations import inicial, validarLogin
from controlador.dto_empleado import EmpleadoDTO
from utils.encoder import Encoder

def menuAccesoUsuarios():
    print("""
||------------------------||
||   SISTEMA DE ARRIENDOS ||
||------------------------||
||1. Login de acceso      ||
||2. Crear cuenta empleado||
||------------------------||
""")

def crearCuentaEmpleado():
    print("\n=== CREAR CUENTA DE EMPLEADO ===")
    run = input("Ingrese RUN: ")
    nombre = input("Ingrese nombre: ")
    apellido = input("Ingrese apellido: ")
    codigo = int(input("Ingrese c√≥digo de empleado: "))
    cargo = input("Ingrese cargo: ")
    password = input("Ingrese contrase√±a: ")
    
    # Verificar si el empleado ya existe
    empleado_existente = EmpleadoDTO().buscarEmpleado(run)
    if empleado_existente is not None:
        print("‚ùå El empleado ya existe en el sistema")
        return False
    
    # Crear nuevo empleado
    resultado = EmpleadoDTO().agregarEmpleado(run, nombre, apellido, codigo, cargo, password)
    print(f"‚úÖ {resultado}")
    return True

def main():
    print("\n" + "="*50)
    print("       SISTEMA DE GESTI√ìN DE ARRIENDOS")
    print("="*50)
    
    menuAccesoUsuarios()
    opc = input("Ingrese opci√≥n: ")
    
    if opc == '1':
        ##### LOGIN CON EMPLEADO #####
        intentos = 1
        while intentos <= 3:
            try:
                resu = validarLogin()  # Este pide RUN y password
                if resu is not None:
                    print(f"\n‚úÖ Bienvenido(a) Sr(a). {resu.getNombre()} {resu.getApellido()}")
                    print(f"üìã Cargo: {resu.getCargo()}")
                    print("="*50)
                    inicial()
                    break
                else:
                    print("‚ùå RUN o contrase√±a incorrecta")
                    intentos += 1
                    if intentos <= 3:
                        print(f"üìù Intentos restantes: {4 - intentos}")
            except Exception as e:
                print(f"‚ùå Error: {e}")
                print("Intente nuevamente")
                
        if intentos == 4:
            print("üö´ Contrase√±a bloqueada - Demasiados intentos fallidos")
            
    elif opc == '2':
        ##### CREAR CUENTA EMPLEADO #####
        try:
            crearCuentaEmpleado()
        except Exception as e:
            print(f"‚ùå Error al crear cuenta: {e}")
    else:
        print("‚ùå Opci√≥n inv√°lida")

if __name__ == "__main__":
    main()